<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©ä¸šç®¡ç†æ¨¡æ‹Ÿå™¨ - å¢å¼ºç‰ˆ</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap">
    <link rel="stylesheet" href="css/index.css">
    <script src="js/enhanced-game.js"></script>
    <style>
        :root {
            --primary-color: #000000; /* è‹¹æœå®˜æ–¹é»‘è‰² */
            --secondary-color: #f5f5f7; /* è‹¹æœå®˜æ–¹ç°è‰² */
            --accent-color: #007aff; /* è‹¹æœå®˜æ–¹è“è‰² */
            --dark-color: #333333; /* æ·±ç°è‰² */
            --light-color: #ffffff; /* ç™½è‰² */
            --success-color: #34c759; /* è‹¹æœå®˜æ–¹ç»¿è‰² */
            --warning-color: #ff9500; /* è‹¹æœå®˜æ–¹æ©™è‰² */
            --danger-color: #ff3b30; /* è‹¹æœå®˜æ–¹çº¢è‰² */
            --box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"; /* è‹¹æœå®˜æ–¹å­—ä½“ */
        }

        body {
            background: var(--light-color);
            color: var(--dark-color);
            overflow-x: hidden;
            min-height: 100vh;
            font-family: var(--font-family);
        }

        .enhanced-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--dark-color);
            box-shadow: var(--box-shadow);
        }

        .game-stats {
            display: flex;
            gap: 2rem;
            font-size: 0.9rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .main-dashboard {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
        }

        .game-modes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .mode-card {
            background: var(--light-color);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: var(--box-shadow);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .mode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-color);
        }

        .mode-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
            color: var(--accent-color);
        }

        .mode-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
        }

        .mode-description {
            color: #666;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .mode-features {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .mode-features li {
            padding: 0.25rem 0;
            color: #555;
            font-size: 0.9rem;
        }

        .mode-features li::before {
            content: 'âœ“';
            color: var(--success-color);
            font-weight: bold;
            margin-right: 0.5rem;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .sidebar-card {
            background: var(--light-color);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: var(--box-shadow);
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--dark-color);
        }

        .achievement-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            background: #f8f9fa;
        }

        .achievement-icon {
            font-size: 1.5rem;
            color: var(--accent-color);
        }

        .achievement-info h4 {
            margin: 0;
            font-size: 0.9rem;
            color: var(--dark-color);
        }

        .achievement-info p {
            margin: 0;
            font-size: 0.8rem;
            color: #666;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            background: #f8f9fa;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .rank {
            font-weight: bold;
            color: var(--primary-color);
        }

        .score {
            font-weight: 600;
            color: var(--success-color);
        }

        .quick-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .action-btn {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            background: var(--primary-color);
            color: var(--light-color);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: #3a5bc7;
            transform: translateY(-2px);
        }

        .action-btn.secondary {
            background: var(--secondary-color);
        }

        .action-btn.secondary:hover {
            background: #2a9a9d;
        }

        .daily-challenge {
            background: linear-gradient(135deg, var(--accent-color), #ff5252);
            color: var(--light-color);
            text-align: center;
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 1rem;
            box-shadow: var(--box-shadow);
        }

        .challenge-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .challenge-reward {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--light-color);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .main-dashboard {
                grid-template-columns: 1fr;
                padding: 0 1rem;
            }

            .game-modes {
                grid-template-columns: 1fr;
            }

            .enhanced-header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .game-stats {
                gap: 1rem;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- å¢å¼ºç‰ˆå¤´éƒ¨ -->
    <header class="enhanced-header">
        <div class="logo-section">
            <h1>ğŸ¢ ç‰©ä¸šç®¡ç†æ¨¡æ‹Ÿå™¨</h1>
            <p>ä¸“ä¸šç‰©ä¸šç®¡ç†ä½“éªŒå¹³å°</p>
        </div>
        <div class="game-stats">
            <div class="stat-item">
                <span>ğŸ†</span>
                <span>ç­‰çº§: <strong id="playerLevel">1</strong></span>
            </div>
            <div class="stat-item">
                <span>â­</span>
                <span>ç»éªŒ: <strong id="playerExp">0/100</strong></span>
            </div>
            <div class="stat-item">
                <span>ğŸ’°</span>
                <span>é‡‘å¸: <strong id="playerCoins">500</strong></span>
            </div>
        </div>
    </header>

    <!-- ä¸»ä»ªè¡¨æ¿ -->
    <main class="main-dashboard">
        <div class="content-area">
            <!-- æ¯æ—¥æŒ‘æˆ˜ -->
            <div class="daily-challenge">
                <div class="challenge-title">ğŸ¯ æ¯æ—¥æŒ‘æˆ˜ï¼šå®Œç¾ç‰©ä¸šç»ç†</div>
                <div class="challenge-reward">å®Œæˆ3ä¸ªåœºæ™¯è·å¾—200é‡‘å¸å’Œç»éªŒå¥–åŠ±</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 33%"></div>
                </div>
            </div>

            <!-- æ¸¸æˆæ¨¡å¼ -->
            <div class="game-modes">
                <div class="mode-card" onclick="startStoryMode()">
                    <span class="mode-icon">ğŸ“–</span>
                    <h3 class="mode-title">æ•…äº‹æ¨¡å¼</h3>
                    <p class="mode-description">ä½“éªŒå®Œæ•´çš„ç‰©ä¸šç®¡ç†æ•…äº‹çº¿ï¼Œä»æ–°æ‰‹åˆ°ä¸“å®¶çš„æˆé•¿å†ç¨‹</p>
                    <ul class="mode-features">
                        <li>20+ç²¾å¿ƒè®¾è®¡çš„åœºæ™¯</li>
                        <li>è§’è‰²å…³ç³»ç³»ç»Ÿ</li>
                        <li>å¤šé‡ç»“å±€</li>
                        <li>æˆå°±è§£é”</li>
                    </ul>
                </div>

                <div class="mode-card" onclick="startChallengeMode()">
                    <span class="mode-icon">âš¡</span>
                    <h3 class="mode-title">æŒ‘æˆ˜æ¨¡å¼</h3>
                    <p class="mode-description">é¢å¯¹å„ç§ç´§æ€¥æƒ…å†µå’Œå¤æ‚é—®é¢˜ï¼Œæµ‹è¯•ä½ çš„åº”å˜èƒ½åŠ›</p>
                    <ul class="mode-features">
                        <li>éšæœºäº‹ä»¶ç”Ÿæˆ</li>
                        <li>æ—¶é—´é™åˆ¶æŒ‘æˆ˜</li>
                        <li>æ’è¡Œæ¦œç«äº‰</li>
                        <li>ç‰¹æ®Šå¥–åŠ±</li>
                    </ul>
                </div>

                <div class="mode-card" onclick="startSandboxMode()">
                    <span class="mode-icon">ğŸ—ï¸</span>
                    <h3 class="mode-title">è‡ªç”±æ¨¡å¼</h3>
                    <p class="mode-description">è‡ªç”±æ¢ç´¢å’Œå®éªŒï¼Œæ²¡æœ‰å‹åŠ›çš„å­¦ä¹ ç¯å¢ƒ</p>
                    <ul class="mode-features">
                        <li>æ— é™åˆ¶æ¢ç´¢</li>
                        <li>è‡ªå®šä¹‰åœºæ™¯</li>
                        <li>å­¦ä¹ å·¥å…·</li>
                        <li>å®éªŒåŠŸèƒ½</li>
                    </ul>
                </div>

                <div class="mode-card" onclick="startTutorial()">
                    <span class="mode-icon">ğŸ“</span>
                    <h3 class="mode-title">æ–°æ‰‹æ•™ç¨‹</h3>
                    <p class="mode-description">ä»é›¶å¼€å§‹å­¦ä¹ ç‰©ä¸šç®¡ç†çš„åŸºç¡€çŸ¥è¯†å’Œæ¸¸æˆæ“ä½œ</p>
                    <ul class="mode-features">
                        <li>äº’åŠ¨å¼æ•™å­¦</li>
                        <li>å®æˆ˜æ¼”ç»ƒ</li>
                        <li>çŸ¥è¯†æµ‹è¯•</li>
                        <li>è¯ä¹¦è·å¾—</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <!-- æœ€æ–°æˆå°± -->
            <div class="sidebar-card">
                <h3 class="sidebar-title">ğŸ† æœ€æ–°æˆå°±</h3>
                <div class="achievement-item">
                    <span class="achievement-icon">ğŸŒŸ</span>
                    <div class="achievement-info">
                        <h4>åˆå‡ºèŒ…åº</h4>
                        <p>å®Œæˆç¬¬ä¸€ä¸ªåœºæ™¯</p>
                    </div>
                </div>
                <div class="achievement-item">
                    <span class="achievement-icon">ğŸ’¼</span>
                    <div class="achievement-info">
                        <h4>å±æœºå¤„ç†ä¸“å®¶</h4>
                        <p>æˆåŠŸå¤„ç†5ä¸ªç´§æ€¥äº‹ä»¶</p>
                    </div>
                </div>
                <div class="achievement-item">
                    <span class="achievement-icon">ğŸ‘¥</span>
                    <div class="achievement-info">
                        <h4>äººé™…å…³ç³»å¤§å¸ˆ</h4>
                        <p>ä¸æ‰€æœ‰NPCå»ºç«‹è‰¯å¥½å…³ç³»</p>
                    </div>
                </div>
            </div>

            <!-- æ’è¡Œæ¦œ -->
            <div class="sidebar-card">
                <h3 class="sidebar-title">ğŸ¥‡ æœ¬å‘¨æ’è¡Œæ¦œ</h3>
                <div class="leaderboard-item">
                    <div class="player-info">
                        <span class="rank">1.</span>
                        <span>ç‰©ä¸šè¾¾äºº</span>
                    </div>
                    <span class="score">9850</span>
                </div>
                <div class="leaderboard-item">
                    <div class="player-info">
                        <span class="rank">2.</span>
                        <span>ç®¡ç†ä¸“å®¶</span>
                    </div>
                    <span class="score">8920</span>
                </div>
                <div class="leaderboard-item">
                    <div class="player-info">
                        <span class="rank">3.</span>
                        <span>æœåŠ¡ä¹‹æ˜Ÿ</span>
                    </div>
                    <span class="score">8650</span>
                </div>
                <div class="leaderboard-item">
                    <div class="player-info">
                        <span class="rank">4.</span>
                        <span>ä½ </span>
                    </div>
                    <span class="score">7200</span>
                </div>
            </div>

            <!-- å¿«é€Ÿæ“ä½œ -->
            <div class="sidebar-card">
                <h3 class="sidebar-title">âš¡ å¿«é€Ÿæ“ä½œ</h3>
                <div class="quick-actions">
                    <button class="action-btn" onclick="continuePrevious()">ç»§ç»­æ¸¸æˆ</button>
                    <button class="action-btn secondary" onclick="showSettings()">è®¾ç½®</button>
                </div>
                <div class="quick-actions">
                    <button class="action-btn" onclick="showHelp()">å¸®åŠ©</button>
                    <button class="action-btn secondary" onclick="showStats()">ç»Ÿè®¡</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // æ¸¸æˆæ•°æ®
        let gameData = {
            level: 1,
            exp: 0,
            coins: 500,
            achievements: [],
            completedScenarios: []
        };

        // åŠ è½½æ¸¸æˆæ•°æ®
        function loadGameData() {
            const saved = localStorage.getItem('propertyManagerGameData');
            if (saved) {
                gameData = { ...gameData, ...JSON.parse(saved) };
            }
            updateUI();
        }

        // ä¿å­˜æ¸¸æˆæ•°æ®
        function saveGameData() {
            localStorage.setItem('propertyManagerGameData', JSON.stringify(gameData));
        }

        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('playerLevel').textContent = gameData.level;
            document.getElementById('playerExp').textContent = `${gameData.exp}/${gameData.level * 100}`;
            document.getElementById('playerCoins').textContent = gameData.coins;
        }

        // æ¸¸æˆæ¨¡å¼å‡½æ•°
        function startStoryMode() {
            showModeSelection('story');
        }

        function startChallengeMode() {
            showModeSelection('challenge');
        }

        function startSandboxMode() {
            showModeSelection('sandbox');
        }

        function startTutorial() {
            const tutorialData = {
                steps: [
                    {
                        title: 'æ¬¢è¿æ¥åˆ°ç‰©ä¸šç®¡ç†æ¨¡æ‹Ÿå™¨ï¼',
                        description: 'åœ¨è¿™ä¸ªæ¸¸æˆä¸­ï¼Œä½ å°†æ‰®æ¼”ä¸€åç‰©ä¸šç»ç†ï¼Œå¤„ç†å„ç§æ—¥å¸¸äº‹åŠ¡å’Œçªå‘äº‹ä»¶ã€‚è®©æˆ‘ä»¬å¼€å§‹å­¦ä¹ åŸºæœ¬æ“ä½œå§ï¼'
                    },
                    {
                        title: 'æ¸¸æˆç•Œé¢ä»‹ç»',
                        description: 'å±å¹•ä¸Šæ–¹æ˜¾ç¤ºä½ çš„ç­‰çº§ã€ç»éªŒå’Œé‡‘å¸ã€‚è¿™äº›æ•°å€¼ä¼šæ ¹æ®ä½ çš„è¡¨ç°è€Œå˜åŒ–ã€‚'
                    },
                    {
                        title: 'é€‰æ‹©æ¸¸æˆæ¨¡å¼',
                        description: 'ä½ å¯ä»¥é€‰æ‹©æ•…äº‹æ¨¡å¼ä½“éªŒå®Œæ•´å‰§æƒ…ï¼Œæˆ–è€…æŒ‘æˆ˜æ¨¡å¼æµ‹è¯•æŠ€èƒ½ï¼Œè¿˜æœ‰è‡ªç”±æ¨¡å¼ä¾›ä½ æ¢ç´¢ã€‚'
                    },
                    {
                        title: 'åœºæ™¯äº’åŠ¨',
                        description: 'åœ¨åœºæ™¯ä¸­ï¼Œä½ éœ€è¦é˜…è¯»æƒ…å†µæè¿°ï¼Œç„¶åé€‰æ‹©æœ€åˆé€‚çš„å¤„ç†æ–¹å¼ã€‚æ¯ä¸ªé€‰æ‹©éƒ½ä¼šå½±å“æ¸¸æˆç»“æœã€‚'
                    },
                    {
                        title: 'æˆå°±ç³»ç»Ÿ',
                        description: 'å®Œæˆç‰¹å®šä»»åŠ¡å¯ä»¥è§£é”æˆå°±ï¼Œè·å¾—ç»éªŒå’Œé‡‘å¸å¥–åŠ±ã€‚åŠªåŠ›æ”¶é›†æ‰€æœ‰æˆå°±å§ï¼'
                    }
                ]
            };

            if (typeof gameSystem !== 'undefined' && gameSystem.tutorialSystem) {
                gameSystem.tutorialSystem.startTutorial(tutorialData);
            } else {
                // å¦‚æœå¢å¼ºç³»ç»ŸæœªåŠ è½½ï¼Œæ˜¾ç¤ºç®€å•æ•™ç¨‹
                alert('æ•™ç¨‹ï¼šæ¬¢è¿æ¥åˆ°ç‰©ä¸šç®¡ç†æ¨¡æ‹Ÿå™¨ï¼ç‚¹å‡»ä»»æ„æ¸¸æˆæ¨¡å¼å¼€å§‹ä½“éªŒã€‚');
            }
        }

        function showModeSelection(mode) {
            // åˆ›å»ºæ¨¡å¼é€‰æ‹©å¼¹çª—
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;

            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 2rem;
                border-radius: 15px;
                max-width: 500px;
                width: 90%;
                text-align: center;
            `;

            content.innerHTML = `
                <h2>é€‰æ‹©${mode === 'story' ? 'æ•…äº‹' : mode === 'challenge' ? 'æŒ‘æˆ˜' : 'è‡ªç”±'}åœºæ™¯</h2>
                <div style="display: grid; gap: 1rem; margin: 2rem 0;">
                    <button onclick="selectScenario('EMERGENCY_ELEVATOR_REPAIR')" class="scenario-btn">ğŸ›— ç´§æ€¥ç”µæ¢¯ç»´ä¿®</button>
                    <button onclick="selectScenario('PET_CRISIS_MANAGEMENT')" class="scenario-btn">ğŸ• å® ç‰©å±æœºç®¡ç†</button>
                    <button onclick="selectScenario('COMMUNITY_FESTIVAL_PLANNING')" class="scenario-btn">ğŸ‰ ç¤¾åŒºèŠ‚æ—¥ç­–åˆ’</button>
                    <button onclick="selectScenario('PROPERTY_FLOOD_EMERGENCY')" class="scenario-btn">ğŸŒŠ åœ°ä¸‹è½¦åº“æ´ªæ°´</button>
                </div>
                <button onclick="closeModal()" style="background: #ccc; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">å–æ¶ˆ</button>
            `;

            // æ·»åŠ æ ·å¼
            const style = document.createElement('style');
            style.textContent = `
                .scenario-btn {
                    background: var(--primary-color);
                    color: white;
                    border: none;
                    padding: 1rem;
                    border-radius: 8px;
                    cursor: pointer;
                    font-size: 1rem;
                    transition: all 0.3s ease;
                }
                .scenario-btn:hover {
                    background: #3a5bc7;
                    transform: translateY(-2px);
                }
            `;
            document.head.appendChild(style);

            modal.appendChild(content);
            document.body.appendChild(modal);

            // å…¨å±€å‡½æ•°
            window.selectScenario = function(scenarioId) {
                window.location.href = `scenario.html?id=${scenarioId}&mode=${mode}`;
            };

            window.closeModal = function() {
                document.body.removeChild(modal);
                document.head.removeChild(style);
            };
        }

        function continuePrevious() {
            const lastScenario = localStorage.getItem('lastScenario') || 'EMERGENCY_ELEVATOR_REPAIR';
            window.location.href = `scenario.html?id=${lastScenario}`;
        }

        function showSettings() {
            const modal = createModal('æ¸¸æˆè®¾ç½®', `
                <div style="text-align: left; margin: 1rem 0;">
                    <label style="display: block; margin: 1rem 0;">
                        <input type="checkbox" id="soundEnabled" ${gameSystem.gameData.settings.soundEnabled ? 'checked' : ''}>
                        å¯ç”¨éŸ³æ•ˆ
                    </label>
                    <label style="display: block; margin: 1rem 0;">
                        <input type="checkbox" id="musicEnabled" ${gameSystem.gameData.settings.musicEnabled ? 'checked' : ''}>
                        å¯ç”¨èƒŒæ™¯éŸ³ä¹
                    </label>
                    <label style="display: block; margin: 1rem 0;">
                        <input type="checkbox" id="autoSave" ${gameSystem.gameData.settings.autoSave ? 'checked' : ''}>
                        è‡ªåŠ¨ä¿å­˜
                    </label>
                    <label style="display: block; margin: 1rem 0;">
                        éš¾åº¦è®¾ç½®ï¼š
                        <select id="difficulty" style="margin-left: 1rem;">
                            <option value="easy" ${gameSystem.gameData.settings.difficulty === 'easy' ? 'selected' : ''}>ç®€å•</option>
                            <option value="normal" ${gameSystem.gameData.settings.difficulty === 'normal' ? 'selected' : ''}>æ™®é€š</option>
                            <option value="hard" ${gameSystem.gameData.settings.difficulty === 'hard' ? 'selected' : ''}>å›°éš¾</option>
                        </select>
                    </label>
                </div>
                <div style="text-align: center; margin-top: 2rem;">
                    <button onclick="saveSettings()" style="background: var(--primary-color); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; margin-right: 1rem; cursor: pointer;">ä¿å­˜è®¾ç½®</button>
                    <button onclick="closeModal()" style="background: #ccc; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">å–æ¶ˆ</button>
                </div>
            `);
        }

        function saveSettings() {
            gameSystem.gameData.settings.soundEnabled = document.getElementById('soundEnabled').checked;
            gameSystem.gameData.settings.musicEnabled = document.getElementById('musicEnabled').checked;
            gameSystem.gameData.settings.autoSave = document.getElementById('autoSave').checked;
            gameSystem.gameData.settings.difficulty = document.getElementById('difficulty').value;

            gameSystem.saveGameData();
            gameSystem.saveSystem.showNotification('è®¾ç½®å·²ä¿å­˜', 'success');
            closeModal();
        }

        function showHelp() {
            const modal = createModal('æ¸¸æˆå¸®åŠ©', `
                <div style="text-align: left; line-height: 1.6;">
                    <h3>ğŸ® æ¸¸æˆæ“ä½œ</h3>
                    <p><strong>Ctrl+S</strong> - å¿«é€Ÿä¿å­˜</p>
                    <p><strong>Ctrl+L</strong> - å¿«é€ŸåŠ è½½</p>

                    <h3>ğŸ¯ æ¸¸æˆç›®æ ‡</h3>
                    <p>ä½œä¸ºç‰©ä¸šç»ç†ï¼Œä½ éœ€è¦å¤„ç†å„ç§æ—¥å¸¸äº‹åŠ¡å’Œçªå‘äº‹ä»¶ï¼Œç»´æŠ¤è‰¯å¥½çš„ç§Ÿæˆ·å…³ç³»ï¼Œä¿æŒå»ºç­‘ç‰©çš„æ­£å¸¸è¿è¥ã€‚</p>

                    <h3>ğŸ“Š è¯„åˆ†ç³»ç»Ÿ</h3>
                    <p><strong>ç§Ÿæˆ·æ»¡æ„åº¦</strong> - å½±å“ç»­ç§Ÿç‡å’Œå£ç¢‘</p>
                    <p><strong>ç»ç†å‹åŠ›</strong> - å½±å“å†³ç­–è´¨é‡</p>
                    <p><strong>å»ºç­‘çŠ¶å†µ</strong> - å½±å“å®‰å…¨å’Œç»´æŠ¤æˆæœ¬</p>
                    <p><strong>è´¢åŠ¡å¥åº·</strong> - å½±å“å¯ç”¨èµ„æº</p>

                    <h3>ğŸ† æˆå°±ç³»ç»Ÿ</h3>
                    <p>å®Œæˆç‰¹å®šä»»åŠ¡å¯ä»¥è§£é”æˆå°±ï¼Œè·å¾—ç»éªŒå’Œé‡‘å¸å¥–åŠ±ã€‚</p>
                </div>
                <div style="text-align: center; margin-top: 2rem;">
                    <button onclick="closeModal()" style="background: var(--primary-color); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">äº†è§£äº†</button>
                </div>
            `);
        }

        function showStats() {
            const stats = gameSystem.analytics.getStats();
            const modal = createModal('æ¸¸æˆç»Ÿè®¡', `
                <div style="text-align: left; line-height: 1.8;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0;">
                        <div><strong>å½“å‰ç­‰çº§ï¼š</strong> ${gameSystem.gameData.level}</div>
                        <div><strong>æ€»ç»éªŒï¼š</strong> ${gameSystem.gameData.exp}</div>
                        <div><strong>é‡‘å¸æ•°é‡ï¼š</strong> ${gameSystem.gameData.coins}</div>
                        <div><strong>æ¸¸æˆæ—¶é•¿ï¼š</strong> ${Math.floor(stats.playTime / 60)}åˆ†é’Ÿ</div>
                        <div><strong>å®Œæˆåœºæ™¯ï¼š</strong> ${gameSystem.gameData.completedScenarios.length}</div>
                        <div><strong>è§£é”æˆå°±ï¼š</strong> ${stats.achievements}</div>
                    </div>

                    <h3>ğŸ† å·²è·å¾—æˆå°±</h3>
                    <div style="max-height: 200px; overflow-y: auto;">
                        ${gameSystem.gameData.achievements.map(id => {
                            const achievement = gameSystem.achievements.achievements[id];
                            return achievement ? `<div style="margin: 0.5rem 0; padding: 0.5rem; background: #f0f0f0; border-radius: 5px;">
                                <span style="margin-right: 0.5rem;">${achievement.icon}</span>
                                <strong>${achievement.name}</strong> - ${achievement.description}
                            </div>` : '';
                        }).join('')}
                    </div>
                </div>
                <div style="text-align: center; margin-top: 2rem;">
                    <button onclick="closeModal()" style="background: var(--primary-color); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">å…³é—­</button>
                </div>
            `);
        }

        function createModal(title, content) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                padding: 2rem;
                border-radius: 15px;
                max-width: 600px;
                width: 90%;
                max-height: 80vh;
                overflow-y: auto;
            `;

            modalContent.innerHTML = `
                <h2 style="margin-top: 0; text-align: center;">${title}</h2>
                ${content}
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            window.closeModal = function() {
                document.body.removeChild(modal);
            };

            return modal;
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç­‰å¾…å¢å¼ºæ¸¸æˆç³»ç»ŸåŠ è½½
            setTimeout(() => {
                if (typeof gameSystem !== 'undefined') {
                    console.log('å¢å¼ºæ¸¸æˆç³»ç»Ÿå·²åŠ è½½');
                    // æ›´æ–°UIæ˜¾ç¤ºå¢å¼ºç³»ç»Ÿçš„æ•°æ®
                    gameSystem.updateUI();
                } else {
                    console.log('ä½¿ç”¨åŸºç¡€æ¸¸æˆæ•°æ®');
                    // ä½¿ç”¨åŸºç¡€çš„æ¸¸æˆæ•°æ®åŠ è½½
                    loadGameData();
                }

                // æ·»åŠ ä¸€äº›åŠ¨ç”»æ•ˆæœ
                const cards = document.querySelectorAll('.mode-card');
                cards.forEach((card, index) => {
                    card.style.animationDelay = `${index * 0.1}s`;
                    card.style.animation = 'fadeInUp 0.6s ease forwards';
                });

                // æ·»åŠ é”®ç›˜å¿«æ·é”®æç¤º
                const helpText = document.createElement('div');
                helpText.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: rgba(0,0,0,0.7);
                    color: white;
                    padding: 0.5rem 1rem;
                    border-radius: 5px;
                    font-size: 0.8rem;
                    z-index: 100;
                `;
                helpText.innerHTML = 'å¿«æ·é”®: Ctrl+S ä¿å­˜ | Ctrl+L åŠ è½½';
                document.body.appendChild(helpText);

                // 3ç§’åéšè—æç¤º
                setTimeout(() => {
                    helpText.style.opacity = '0';
                    helpText.style.transition = 'opacity 0.5s';
                    setTimeout(() => helpText.remove(), 500);
                }, 3000);

            }, 100);
        });

        // æ·»åŠ CSSåŠ¨ç”»
        const animationStyle = document.createElement('style');
        animationStyle.textContent = `
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .mode-card {
                opacity: 0;
            }
        `;
        document.head.appendChild(animationStyle);
    </script>
</body>
</html>
